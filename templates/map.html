{% extends "base.html" %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <h2 class="border-bottom pb-2">üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç: ¬´–ü–µ—Ä–º—å –í–µ–ª–∏–∫–∞—è¬ª</h2>
        <p class="text-muted">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏.</p>
    </div>
</div>

<div class="row h-100">
    <!-- –ë–ª–æ–∫ —Å–æ —Å–ø–∏—Å–∫–æ–º –º–µ—Å—Ç (–°–∞–π–¥–±–∞—Ä) -->
    <div class="col-lg-4 order-lg-2 mb-4">
        <div class="list-group shadow-sm overflow-auto" style="max-height: 600px;">
            <div class="list-group-item list-group-item-action active bg-success border-success">
                –°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ (10)
            </div>
            {% for stop in stops %}
            <a href="/stop/{{ stop.id }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ stop.id }}. {{ stop.title }}</strong>
                    <br>
                    <small class="text-muted">{{ stop.short_desc }}</small>
                </div>
                <span class="badge bg-secondary rounded-pill">Info</span>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- –ë–ª–æ–∫ —Å —Å–∞–º–æ–π –∫–∞—Ä—Ç–æ–π -->
    <div class="col-lg-8 order-lg-1">
        <div id="map" class="shadow-lg border border-3 border-white"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã (–ø–æ–∫–∞ –±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ –∑—É–º–∞)
    var map = L.map('map', {
        attributionControl: false // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–ø–∏—Ä–∞–π—Ç
    });

    // 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —á–∏—Å—Ç—É—é –ø–æ–¥–ø–∏—Å—å (–±–µ–∑ —Ñ–ª–∞–≥–æ–≤ –∏ —Ä–µ–∫–ª–∞–º—ã)
    L.control.attribution({ prefix: false }).addTo(map);

    // 3. –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –∫–∞—Ä—Ç—ã
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" style="color: #666; text-decoration: none;">OpenStreetMap</a>'
    }).addTo(map);

    // 4. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    var stops = {{ stops | tojson }};

    // 5. –°–æ–∑–¥–∞–µ–º "–≥—Ä—É–ø–ø—É" –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø–æ –Ω–µ–π –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã
    var markersGroup = L.featureGroup();

    stops.forEach(function(stop) {
        var marker = L.marker(stop.coords);
        
        var popupContent = `
            <div style="text-align: center; min-width: 200px;">
                <h6 style="margin: 0; color: #004d40;">${stop.title}</h6>
                <hr style="margin: 5px 0;">
                <p style="font-size: 12px; margin-bottom: 10px;">${stop.short_desc}</p>
                <a href="/stop/${stop.id}" class="btn btn-sm btn-success text-white" style="text-decoration: none;">
                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –æ–±—ä–µ–∫—Ç–µ
                </a>
            </div>
        `;
        
        marker.bindPopup(popupContent);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –≤ –≥—Ä—É–ø–ø—É
        marker.addTo(markersGroup);
    });

    // 6. –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É
    markersGroup.addTo(map);

    // 7. –ì–õ–ê–í–ù–û–ï: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥–æ–Ω—è–µ–º –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –≤–ª–µ–∑–ª–∏ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
    // padding: [50, 50] –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å—Ç—É–ø—ã –≤ –ø–∏–∫—Å–µ–ª—è—Ö, —á—Ç–æ–±—ã –º–∞—Ä–∫–µ—Ä—ã –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª–∏ –∫ –∫—Ä–∞—è–º
    map.fitBounds(markersGroup.getBounds(), { padding: [50, 50] });
</script>
{% endblock %}